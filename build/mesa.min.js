"use strict";$(document).ready(function(){var t=ace.edit("text-editor");t.setTheme("ace/theme/monokai"),t.setFontSize("14px"),t.getSession().setUseWrapMode(!0),t.getSession().setMode("ace/mode/xml")});var MesaModel=function(){this.editor=ace.edit("text-editor"),this.tagListJson=[],this.addedTagListJson=[]},MesaView=function(){function t(){}return t.prototype.writeTextArea=function(t,e){e.editor.session.setValue(t)},t.prototype.initUploadButton=function(){$("#upload-button").replaceWith('\n    <form>\n    <label class="func-btn" for="upload-button" style="cursor: pointer">\n      Open\n      <input type="file" id="upload-button" style="display:none;">\n    </label>\n    <span class="file-info" id="file-name"></span>\n    </form>')},t.prototype.initSaveButton=function(){$("#save-button").replaceWith('\n    <table>\n    <tr>\n      <td>\n        <div class="func-btn" style="cursor: pointer"><a id="text-donwload" download="mesa_file.xml" href="#">Save</a></div>\n      </td>\n      <td>\n        <input type=\'text\' id="download-filename" placeholder="Enter a file name">\n        <span class="file-info">.xml</span>\n      </td>\n    </tr>\n    </table>')},t.prototype.initTagUploadButton=function(){$("#tag-upload-button").replaceWith('\n    <form>\n      <label class="func-btn" id="load-json" for="load-tags-button" style="cursor: pointer">\n        Load Tags\n        <input type="file" id="load-tags-button" style="display:none;">\n      </label>\n      <span class="file-info" id="tag-file-name"></span>\n    </form>')},t.prototype.initTagSaveButton=function(){$("#tag-save-button").replaceWith('\n    <div class="func-btn" style="cursor: pointer"><a id="json-donwload" download="mesa_tags.json" href="#">Save Tags</a></div>\n    <input type=\'text\' id="download-jsonname" placeholder="Enter a file name">\n    <span class="file-info">.json</span>')},t.prototype.initTagSettingTable=function(){$("#tag-setting-table").html('\n    <table class="tag-setting-table">\n    <tr>\n      \n    <td class="table-header">XML Tag?</td>\n    <td>\n      <input id="xml-flag" type="checkbox">\n      <label for="xml-flag"></label>\n    </td>\n    </tr>\n    <tr>\n    \n    <td class="table-header">Name</td>\n    <td><input type=\'text\' id="tag-name-form" placeholder="Enter a tag name"></td>\n    </tr>\n    <tr id="tag-separator">\n      \n    <td class=" table-header">Separator</td>\n    <td><input type=\'text\' id="tag-sep-form" placeholder="If you need ..."></td>\n    </tr>\n    <tr id="attributes-header">\n      <td class="table-header">Attributes<div class="func-btn" id="add-attribute" style="cursor: pointer; width: 20px; height: 20px; padding: 0;">+</div></td>\n    </tr>\n    </table>\n    <table class="tag-setting-table" id="attributes-input">\n    <tr>\n    \n    <td><input type=\'text\' class="attribute-name-form" placeholder="Enter a name"></td>\n    <td><input type=\'text\' class="attribute-value-form" placeholder="Enter a value"></td>\n    </tr>\n    </table>')},t.prototype.makeTagButton=function(t){for(var n="",e=function(t){if(t.xmlFlag){var e="";t.attributes.forEach(function(t){e+=t.name+"__MESA_ATTRIBUTE_SEPARATOR__"+t.value+","}),n+='<div class="func-btn xml-tag-btn" val="'+t.name+'" attributes="'+e+'" style="cursor: pointer">'+t.name+"</div>"}else n+='<div class="func-btn tag-btn" val="'+(t.sepChar+t.name)+'" style="cursor: pointer">'+t.name+"</div>"},a=0,o=t;a<o.length;a++){e(o[a])}$("#tags").append(n)},t.prototype.hideAddedMsg=function(){$("#added-message").hide()},t.prototype.showAddedMsg=function(t){$("#added-message").append(""),document.getElementById("added-message").innerText=t.name+" was added.",$("#added-message").show(),$("#added-message").fadeOut(1500)},t.prototype.addAttributesInput=function(){$("#attributes-input").append('<tr>\n    <td><input type=\'text\' id="attribute-name-form" placeholder="Enter a name"></td>\n    <td><input type=\'text\' id="attribute-value-form" placeholder="Enter a value"></td></tr>')},t}(),MesaController=function(){function t(){this.model=new MesaModel,this.view=new MesaView,this.view.initUploadButton(),this.view.initSaveButton(),this.view.initTagUploadButton(),this.view.initTagSaveButton(),this.view.initTagSettingTable(),this.loadTextFile(this.model,this.view),this.loadJsonFile(this.model,this.view),this.insertTag(this.model,this.view),this.insertXMLTag(this.model,this.view),this.addTag(this.model,this.view),this.activateClearButton(this.model,this.view),this.showAttributes(),this.addAttributes(this.model,this.view),this.downloadText(this.model,this.view),this.downloadJson(this.model,this.view),this.alertWhenReload(),this.dragController()}return t.prototype.loadTextFile=function(a,o){var i=this;$("#upload-button").on("change",function(t){var e=t.target.files,n=new FileReader;n.readAsText(e[0]),n.onload=function(){o.writeTextArea(i.insertXmlDeclaration(String(n.result)),a)},$("#file-name").text(e[0].name)})},t.prototype.loadJsonFile=function(a,o){$("#load-tags-button").on("change",function(t){var e=t.target.files,n=new FileReader;n.readAsText(e[0]),n.onload=function(){var t=JSON.parse(String(n.result));t&&(a.tagListJson=t),o.makeTagButton(a.tagListJson)},$("#tag-file-name").text(e[0].name)})},t.prototype.insertXmlDeclaration=function(t){return/<\?xml[^>]+>/.test(t)?t:'<?xml version="1.0" encoding="UTF-8" ?>\n'+t},t.prototype.insertTag=function(o,t){$("#tags").on("click",".tag-btn",function(){for(var t=$(this).attr("val"),e=0,n=o.editor.getSelection().getAllRanges();e<n.length;e++){var a=n[e];o.editor.session.insert(a.end,t)}})},t.prototype.insertXMLTag=function(r,t){$("#tags").on("click",".xml-tag-btn",function(){var t=r.editor.getSelection().getAllRanges(),n="";$(this).attr("attributes").split(",").forEach(function(t){var e=t.split("__MESA_ATTRIBUTE_SEPARATOR__");e[0]&&e[1]&&(n+=" "+e[0]+'="'+e[1]+'"')});var e="<"+$(this).attr("val")+n+">",a="</"+$(this).attr("val")+">";if(1===t.length)r.editor.session.insert(t[0].end,a),r.editor.session.insert(t[0].start,e);else for(var o=0,i=t;o<i.length;o++){var s=i[o];r.editor.session.insert(s.start,e),r.editor.session.insert(s.end,a)}})},t.prototype.showAttributes=function(){$("#attributes-header").hide(),$("#attributes-input").hide(),$(document).on("change","#xml-flag",function(){$(this).prop("checked")?($("#attributes-header").show(),$("#attributes-input").show(),$("#tag-separator").hide()):($("#attributes-header").hide(),$("#attributes-input").hide(),$("#tag-separator").show())})},t.prototype.addAttributes=function(t,e){$("#add-attribute").on("click",function(){e.addAttributesInput()})},t.prototype.addTag=function(e,n){var a=this;$("#add-tag-btn").on("click",function(){var t={name:document.getElementById("tag-name-form").value||"name",sepChar:document.getElementById("tag-sep-form").value||"\t",xmlFlag:document.getElementById("xml-flag").checked,attributes:a.getAttributes()};e.addedTagListJson.push(t),n.makeTagButton([t]),n.showAddedMsg(t)})},t.prototype.getAttributes=function(){var n=[];return $("#attributes-input").find("tr").each(function(t,e){var a={name:"",value:""};$(e).find("input").each(function(t,e){var n=e;0===t?a.name=n.value:a.value=n.value}),n.push(a)}),n},t.prototype.activateClearButton=function(e,n){var a=this;$("#clear-btn").on("click",function(t){n.initTagSettingTable(),a.showAttributes(),a.addAttributes(e,n)})},t.prototype.downloadText=function(a,t){$("#text-donwload").on("click",function(t){var e=t.target;e.href=URL.createObjectURL(new Blob([a.editor.session.getValue()],{type:"text/plain"}));var n=$("#download-filename").val()||"mesa_file";e.download=n+".xml"})},t.prototype.downloadJson=function(a,t){$("#json-donwload").on("click",function(t){var e=t.target;e.href=URL.createObjectURL(new Blob([JSON.stringify(a.tagListJson.concat(a.addedTagListJson),null,2)],{type:"text/plain"}));var n=$("#download-jsonname").val()||"mesa_tags";e.download=n+".json"})},t.prototype.alertWhenReload=function(){$(window).on("beforeunload",function(t){return"Data will be lost if you leave the page, are you sure?"})},t.prototype.dragController=function(){var n,a;function o(t){var e=document.getElementsByClassName("drag")[0];e.style.top=t.pageY-a+"px",e.style.left=t.pageX-n+"px",e.addEventListener("mouseup",i,!1),document.body.addEventListener("mouseleave",i,!1)}function i(){var t=document.getElementsByClassName("drag")[0];document.body.removeEventListener("mousemove",o,!1),null!=t&&(t.removeEventListener("mouseup",i,!1),t.classList.remove("drag"))}$("#tags")[0].addEventListener("dragstart",function(t){var e=t.target;e.classList.add("drag"),n=t.pageX-e.offsetLeft,a=t.pageY-e.offsetTop,document.body.addEventListener("mousemove",o,!1)})},t}();$(document).ready(function(){new MesaController});